<channel version="3.5.0">
  <id>a2e7b476-50b9-42f1-a8f4-718b41b5c7fe</id>
  <nextMetaDataId>3</nextMetaDataId>
  <name>FHIR Dedupe</name>
  <description></description>
  <revision>34</revision>
  <sourceConnector version="3.5.0">
    <metaDataId>0</metaDataId>
    <name>sourceConnector</name>
    <properties class="com.mirth.connect.connectors.fhir.shared.FhirReceiverProperties" version="3.5.0">
      <pluginProperties>
        <com.mirth.connect.plugins.httpauth.NoneHttpAuthProperties version="3.5.0">
  <authType>NONE</authType>
        </com.mirth.connect.plugins.httpauth.NoneHttpAuthProperties>
      </pluginProperties>
      <listenerConnectorProperties version="3.5.0">
        <host>0.0.0.0</host>
        <port>80</port>
      </listenerConnectorProperties>
      <sourceConnectorProperties version="3.5.0">
        <responseVariable>None</responseVariable>
        <respondAfterProcessing>true</respondAfterProcessing>
        <processBatch>false</processBatch>
        <firstResponse>false</firstResponse>
        <processingThreads>1</processingThreads>
        <resourceIds class="linked-hash-map">
          <entry>
            <string>Default Resource</string>
            <string>[Default Resource]</string>
          </entry>
        </resourceIds>
        <queueBufferSize>1000</queueBufferSize>
      </sourceConnectorProperties>
      <contextPath>dstu2</contextPath>
      <timeout>0</timeout>
      <conformanceTemplate></conformanceTemplate>
      <conformanceURL></conformanceURL>
      <conformanceName></conformanceName>
      <supportsXML>true</supportsXML>
      <supportsJSON>true</supportsJSON>
      <systemInteractions>
        <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_TRANSACTION</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
        <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_SEARCH_SYSTEM</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
        <com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>FHIR_HISTORY_SYSTEM</com.mirth.connect.connectors.fhir.shared.FhirRestfulInteraction>
      </systemInteractions>
      <resourceProperties>
        <disabledInteractions/>
      </resourceProperties>
    </properties>
    <transformer version="3.5.0">
      <elements/>
      <inboundDataType>JSON</inboundDataType>
      <outboundDataType>JSON</outboundDataType>
      <inboundProperties class="com.mirth.connect.plugins.datatypes.json.JSONDataTypeProperties" version="3.5.0">
        <batchProperties class="com.mirth.connect.plugins.datatypes.json.JSONBatchProperties" version="3.5.0">
          <splitType>JavaScript</splitType>
          <batchScript></batchScript>
        </batchProperties>
      </inboundProperties>
      <outboundProperties class="com.mirth.connect.plugins.datatypes.json.JSONDataTypeProperties" version="3.5.0">
        <batchProperties class="com.mirth.connect.plugins.datatypes.json.JSONBatchProperties" version="3.5.0">
          <splitType>JavaScript</splitType>
          <batchScript></batchScript>
        </batchProperties>
      </outboundProperties>
    </transformer>
    <filter version="3.5.0">
      <elements/>
    </filter>
    <transportName>FHIR Listener</transportName>
    <mode>SOURCE</mode>
    <enabled>true</enabled>
    <waitForPrevious>true</waitForPrevious>
  </sourceConnector>
  <destinationConnectors>
    <connector version="3.5.0">
      <metaDataId>1</metaDataId>
      <name>Destination 1</name>
      <properties class="com.mirth.connect.connectors.jdbc.DatabaseDispatcherProperties" version="3.5.0">
        <pluginProperties/>
        <destinationConnectorProperties version="3.5.0">
          <queueEnabled>false</queueEnabled>
          <sendFirst>false</sendFirst>
          <retryIntervalMillis>10000</retryIntervalMillis>
          <regenerateTemplate>false</regenerateTemplate>
          <retryCount>0</retryCount>
          <rotate>false</rotate>
          <includeFilterTransformer>false</includeFilterTransformer>
          <threadCount>1</threadCount>
          <threadAssignmentVariable></threadAssignmentVariable>
          <validateResponse>false</validateResponse>
          <resourceIds class="linked-hash-map">
            <entry>
              <string>Default Resource</string>
              <string>[Default Resource]</string>
            </entry>
          </resourceIds>
          <queueBufferSize>1000</queueBufferSize>
          <reattachAttachments>true</reattachAttachments>
        </destinationConnectorProperties>
        <driver>org.postgresql.Driver</driver>
        <url>jdbc:postgresql://localhost:5432/dedupedb</url>
        <username>postgres</username>
        <password>admin</password>
        <query>INSERT INTO message_audit (uuid, input_message, message_source, created_tstamp, created_by_id)
VALUES (${maps.get(&apos;FHIR UNIQUE ID&apos;)},convert_to(${message.rawData}, &apos;UTF8&apos;),${source_name},current_timestamp,1)</query>
        <useScript>false</useScript>
      </properties>
      <transformer version="3.5.0">
        <elements>
          <com.mirth.connect.plugins.mapper.MapperStep>
            <name>FHIR UNIQUE ID</name>
            <sequenceNumber>0</sequenceNumber>
            <variable>FHIR UNIQUE ID</variable>
            <mapping>UUIDGenerator.getUUID()</mapping>
            <defaultValue></defaultValue>
            <replacements/>
            <scope>CHANNEL</scope>
          </com.mirth.connect.plugins.mapper.MapperStep>
          <com.mirth.connect.plugins.mapper.MapperStep>
            <name>source_name</name>
            <sequenceNumber>1</sequenceNumber>
            <variable>source_name</variable>
            <mapping>msg[&apos;source&apos;][&apos;name&apos;]</mapping>
            <defaultValue></defaultValue>
            <replacements/>
            <scope>CHANNEL</scope>
          </com.mirth.connect.plugins.mapper.MapperStep>
        </elements>
        <inboundTemplate encoding="base64">eyJyZXNvdXJjZVR5cGUiOiJNZXNzYWdlSGVhZGVyIiwic291cmNlIjp7Im5hbWUiOiJBRFQxIn0s
ImRlc3RpbmF0aW9uIjpbeyJuYW1lIjoiTWV0ZW9yIEFwcCJ9XSwiZGF0YSI6W3sicmVzb3VyY2VU
eXBlIjoiUGF0aWVudCIsImdlbmRlciI6Ik0tIiwiYmlydGhEYXRlIjoiMTk2MTA2MTUiLCJpZGVu
dGlmaWVyIjpbeyJ1c2UiOiJ1c3VhbCIsInR5cGUiOnsiY29kaW5nIjpbeyJzeXN0ZW0iOiJtaXJ0
aC96ZW1vc28iLCJjb2RlIjoiTVIifV19LCJ2YWx1ZSI6ImY4ZDk4NjgxLTczOWMtNDIzNi05Y2Nm
LWQ0MGM2ZTRkNjYwZiJ9LHsidXNlIjoidXN1YWwiLCJ0eXBlIjp7ImNvZGluZyI6W3sic3lzdGVt
IjoiaHR0cDovL2hsNy5vcmcvZmhpci92Mi8wMjAzIiwiY29kZSI6Ik1SIn1dfSwidmFsdWUiOiJQ
QVRJRDEyMzQifSx7InR5cGUiOnsiY29kaW5nIjpbeyJzeXN0ZW0iOiJodHRwOi8vaGw3Lm9yZy9m
aGlyL3YyLzAyMDMiLCJjb2RlIjoiU1MifV19LCJzeXN0ZW0iOiJodHRwOi8vaGw3Lm9yZy9maGly
L3NpZC91cy1zc24iLCJ2YWx1ZSI6IjEyMzQ1Njc4OSJ9XSwibmFtZSI6W3siZmFtaWx5IjpbIkpP
TkVTIl0sImdpdmVuIjpbIldJTExJQU0iXSwidGV4dCI6IldJTExJQU0gSk9ORVMifV19XX0=</inboundTemplate>
        <outboundTemplate encoding="base64"></outboundTemplate>
        <inboundDataType>JSON</inboundDataType>
        <outboundDataType>JSON</outboundDataType>
        <inboundProperties class="com.mirth.connect.plugins.datatypes.json.JSONDataTypeProperties" version="3.5.0">
          <batchProperties class="com.mirth.connect.plugins.datatypes.json.JSONBatchProperties" version="3.5.0">
            <splitType>JavaScript</splitType>
            <batchScript></batchScript>
          </batchProperties>
        </inboundProperties>
        <outboundProperties class="com.mirth.connect.plugins.datatypes.json.JSONDataTypeProperties" version="3.5.0">
          <batchProperties class="com.mirth.connect.plugins.datatypes.json.JSONBatchProperties" version="3.5.0">
            <splitType>JavaScript</splitType>
            <batchScript></batchScript>
          </batchProperties>
        </outboundProperties>
      </transformer>
      <responseTransformer version="3.5.0">
        <elements/>
        <inboundDataType>JSON</inboundDataType>
        <outboundDataType>JSON</outboundDataType>
        <inboundProperties class="com.mirth.connect.plugins.datatypes.json.JSONDataTypeProperties" version="3.5.0">
          <batchProperties class="com.mirth.connect.plugins.datatypes.json.JSONBatchProperties" version="3.5.0">
            <splitType>JavaScript</splitType>
            <batchScript></batchScript>
          </batchProperties>
        </inboundProperties>
        <outboundProperties class="com.mirth.connect.plugins.datatypes.json.JSONDataTypeProperties" version="3.5.0">
          <batchProperties class="com.mirth.connect.plugins.datatypes.json.JSONBatchProperties" version="3.5.0">
            <splitType>JavaScript</splitType>
            <batchScript></batchScript>
          </batchProperties>
        </outboundProperties>
      </responseTransformer>
      <filter version="3.5.0">
        <elements/>
      </filter>
      <transportName>Database Writer</transportName>
      <mode>DESTINATION</mode>
      <enabled>true</enabled>
      <waitForPrevious>true</waitForPrevious>
    </connector>
    <connector version="3.5.0">
      <metaDataId>2</metaDataId>
      <name>Destination 2</name>
      <properties class="com.mirth.connect.connectors.jdbc.DatabaseDispatcherProperties" version="3.5.0">
        <pluginProperties/>
        <destinationConnectorProperties version="3.5.0">
          <queueEnabled>false</queueEnabled>
          <sendFirst>false</sendFirst>
          <retryIntervalMillis>10000</retryIntervalMillis>
          <regenerateTemplate>false</regenerateTemplate>
          <retryCount>0</retryCount>
          <rotate>false</rotate>
          <includeFilterTransformer>false</includeFilterTransformer>
          <threadCount>1</threadCount>
          <threadAssignmentVariable></threadAssignmentVariable>
          <validateResponse>false</validateResponse>
          <resourceIds class="linked-hash-map">
            <entry>
              <string>Default Resource</string>
              <string>[Default Resource]</string>
            </entry>
          </resourceIds>
          <queueBufferSize>1000</queueBufferSize>
          <reattachAttachments>true</reattachAttachments>
        </destinationConnectorProperties>
        <driver>org.postgresql.Driver</driver>
        <url>jdbc:postgresql://localhost:5432/dedupedb</url>
        <username>postgres</username>
        <password>admin</password>
        <query>UPDATE message_audit
SET transformed_message = to_jsonb(${message.transformedData}),
    last_updated_tstamp =  current_timestamp,
    last_updated_by_id = 2
WHERE
  uuid = ${maps.get(&apos;FHIR UNIQUE ID&apos;)};</query>
        <useScript>false</useScript>
      </properties>
      <transformer version="3.5.0">
        <elements>
          <com.mirth.connect.plugins.mapper.MapperStep>
            <name>birthdate</name>
            <sequenceNumber>0</sequenceNumber>
            <variable>birthdate</variable>
            <mapping>msg[&apos;birthDate&apos;]</mapping>
            <defaultValue></defaultValue>
            <replacements/>
            <scope>CHANNEL</scope>
          </com.mirth.connect.plugins.mapper.MapperStep>
          <com.mirth.connect.plugins.mapper.MapperStep>
            <name>gender</name>
            <sequenceNumber>1</sequenceNumber>
            <variable>gender</variable>
            <mapping>msg[&apos;gender&apos;]</mapping>
            <defaultValue></defaultValue>
            <replacements/>
            <scope>CHANNEL</scope>
          </com.mirth.connect.plugins.mapper.MapperStep>
          <com.mirth.connect.plugins.mapper.MapperStep>
            <name>identifier</name>
            <sequenceNumber>2</sequenceNumber>
            <variable>identifier</variable>
            <mapping>msg[&apos;identifier&apos;]</mapping>
            <defaultValue></defaultValue>
            <replacements/>
            <scope>CHANNEL</scope>
          </com.mirth.connect.plugins.mapper.MapperStep>
          <com.mirth.connect.plugins.mapper.MapperStep>
            <name>address_use</name>
            <sequenceNumber>3</sequenceNumber>
            <variable>address_use</variable>
            <mapping>msg[&apos;address&apos;][0][&apos;use&apos;]</mapping>
            <defaultValue></defaultValue>
            <replacements/>
            <scope>CHANNEL</scope>
          </com.mirth.connect.plugins.mapper.MapperStep>
          <com.mirth.connect.plugins.mapper.MapperStep>
            <name>address_line</name>
            <sequenceNumber>4</sequenceNumber>
            <variable>address_line</variable>
            <mapping>msg[&apos;address&apos;][0][&apos;line&apos;][0]</mapping>
            <defaultValue></defaultValue>
            <replacements/>
            <scope>CHANNEL</scope>
          </com.mirth.connect.plugins.mapper.MapperStep>
          <com.mirth.connect.plugins.mapper.MapperStep>
            <name>address_city</name>
            <sequenceNumber>5</sequenceNumber>
            <variable>address_city</variable>
            <mapping>msg[&apos;address&apos;][0][&apos;city&apos;]</mapping>
            <defaultValue></defaultValue>
            <replacements/>
            <scope>CHANNEL</scope>
          </com.mirth.connect.plugins.mapper.MapperStep>
          <com.mirth.connect.plugins.mapper.MapperStep>
            <name>address_state</name>
            <sequenceNumber>6</sequenceNumber>
            <variable>address_state</variable>
            <mapping>msg[&apos;address&apos;][0][&apos;state&apos;]</mapping>
            <defaultValue></defaultValue>
            <replacements/>
            <scope>CHANNEL</scope>
          </com.mirth.connect.plugins.mapper.MapperStep>
          <com.mirth.connect.plugins.mapper.MapperStep>
            <name>address_postalcode</name>
            <sequenceNumber>7</sequenceNumber>
            <variable>address_postalcode</variable>
            <mapping>msg[&apos;address&apos;][0][&apos;postalCode&apos;]</mapping>
            <defaultValue></defaultValue>
            <replacements/>
            <scope>CHANNEL</scope>
          </com.mirth.connect.plugins.mapper.MapperStep>
          <com.mirth.connect.plugins.mapper.MapperStep>
            <name>address_country</name>
            <sequenceNumber>8</sequenceNumber>
            <variable>address_country</variable>
            <mapping>msg[&apos;address&apos;][0][&apos;country&apos;]</mapping>
            <defaultValue></defaultValue>
            <replacements/>
            <scope>CHANNEL</scope>
          </com.mirth.connect.plugins.mapper.MapperStep>
          <com.mirth.connect.plugins.mapper.MapperStep>
            <name>name_family</name>
            <sequenceNumber>9</sequenceNumber>
            <variable>name_family</variable>
            <mapping>msg[&apos;name&apos;][0][&apos;family&apos;][0]</mapping>
            <defaultValue></defaultValue>
            <replacements/>
            <scope>CHANNEL</scope>
          </com.mirth.connect.plugins.mapper.MapperStep>
          <com.mirth.connect.plugins.mapper.MapperStep>
            <name>name_given</name>
            <sequenceNumber>10</sequenceNumber>
            <variable>name_given</variable>
            <mapping>msg[&apos;name&apos;][0][&apos;given&apos;][0]</mapping>
            <defaultValue></defaultValue>
            <replacements/>
            <scope>CHANNEL</scope>
          </com.mirth.connect.plugins.mapper.MapperStep>
          <com.mirth.connect.plugins.javascriptstep.JavaScriptStep>
            <sequenceNumber>11</sequenceNumber>
            <script>var Patient = {};
Patient.resourceType = &quot;Patient&quot;;
Patient.gender = $(&apos;gender&apos;);
Patient.birthDate = $(&apos;birthdate&apos;);
var ssn =&apos;&apos;; 
for(var i in msg[&apos;identifier&apos;])
{
 	if(msg[&apos;identifier&apos;][i][&apos;type&apos;]!= null){
 		if(msg[&apos;identifier&apos;][i][&apos;type&apos;][&apos;coding&apos;]!= null){    
     		if(msg[&apos;identifier&apos;][i][&apos;type&apos;][&apos;coding&apos;][0][&apos;system&apos;]!= null){
     			if(msg[&apos;identifier&apos;][i][&apos;type&apos;][&apos;coding&apos;][0][&apos;system&apos;]
     			.equals(&apos;http://hl7.org/fhir/sid/us-ssn&apos;) == true)
     				var ssn = msg[&apos;identifier&apos;][i][&apos;value&apos;];
     		}
   	  }
 	}
}
if(ssn != null)
	ssn = ssn.toString().substr(0,5)+&apos;xxxx&apos;;
Patient.identifier = [{
     &quot;use&quot;: &quot;usual&quot;,
     &quot;type&quot;: {
       &quot;coding&quot;: [
         {
           &quot;system&quot;: &quot;http://hl7.org/fhir/sid/us-ssn&quot;,
           &quot;code&quot;: &quot;SS&quot;
         }
       ]
     },
     &quot;value&quot;: ssn.toString()
   }];

var lastName = $(&apos;name_family&apos;).toString().toLowerCase();
var firstName = $(&apos;name_given&apos;).toString().toLowerCase();

var humanName = {
	family : lastName,
	given : firstName,
	text : firstName+&apos; &apos;+lastName
	};
Patient.name = [humanName];
var address ={
	&quot;use&quot;: $(&apos;address_use&apos;),
      &quot;type&quot;: &quot;&quot;,
      &quot;text&quot;:  $(&apos;address_line&apos;)+&apos;, &apos;+$(&apos;address_city&apos;)+&apos;, &apos;+$(&apos;address_state&apos;)+&apos; ,&apos;+$(&apos;address_postalcode&apos;),
      &quot;line&quot;: [
        $(&apos;address_line&apos;)
      ],
      &quot;city&quot;: $(&apos;address_city&apos;),      
      &quot;state&quot;: $(&apos;address_state&apos;),
      &quot;postalCode&quot;: $(&apos;address_postalcode&apos;)      
      }
Patient.address = [address];
var messageHeader = {};

messageHeader.resourceType = &quot;MessageHeader&quot;;
messageHeader.id = {
	&quot;uuid&quot;: $(&apos;FHIR UNIQUE ID&apos;)
}

messageHeader.source = {
	
	name: $(&apos;source_name&apos;)
}
messageHeader.destination = [{
	name: &apos;Data-Management&apos;
}]
messageHeader.data = [Patient];

msg = JSON.stringify(messageHeader);</script>
          </com.mirth.connect.plugins.javascriptstep.JavaScriptStep>
        </elements>
        <inboundTemplate encoding="base64">ewogICJyZXNvdXJjZVR5cGUiOiAiUGF0aWVudCIsCiAgImJpcnRoRGF0ZSI6ICIxOTg1LTA4LTAx
IiwKICAiYWN0aXZlIjogdHJ1ZSwKICAiZ2VuZGVyIjogIm1hbGUiLAogICJkZWNlYXNlZEJvb2xl
YW4iOiBmYWxzZSwKICAiaWQiOiAiVGJ0M0t1Q1kwQjVQU3JKdkN1MmotUGxLLmFpSHN1MnhValVN
OGJXcGV0WG9CIiwKICAiY2FyZVByb3ZpZGVyIjogWwogICAgewogICAgICAiZGlzcGxheSI6ICJQ
aHlzaWNpYW4gRmFtaWx5IE1lZGljaW5lIiwKICAgICAgInJlZmVyZW5jZSI6ICJodHRwczovL29w
ZW4taWMuZXBpYy5jb20vRkhJUi9hcGkvRkhJUi9EU1RVMi9QcmFjdGl0aW9uZXIvVDNNejNLTEJE
VlhYZ2FSb2VlM0VLQUFCIgogICAgfQogIF0sCiAgIm5hbWUiOiBbCiAgICB7CiAgICAgICJ1c2Ui
OiAidXN1YWwiLAogICAgICAiZmFtaWx5IjogWwogICAgICAgICJBcmdvbmF1dCIKICAgICAgXSwK
ICAgICAgImdpdmVuIjogWwogICAgICAgICJKYXNvbiIKICAgICAgXQogICAgfQogIF0sCiAgImlk
ZW50aWZpZXIiOiBbCiAgICB7CiAgICAgICJ1c2UiOiAidXN1YWwiLAogICAgICAic3lzdGVtIjog
InVybjpvaWQ6MS4yLjg0MC4xMTQzNTAuMS4xMy4zMjcuMS43LjUuNzM3Mzg0LjAiLAogICAgICAi
dmFsdWUiOiAiRTM4MjYiCiAgICB9LAogICAgewogICAgICAidXNlIjogInVzdWFsIiwKICAgICAg
InN5c3RlbSI6ICJ1cm46b2lkOjEuMi4zLjQiLAogICAgICAidmFsdWUiOiAiMjAzNTc5IgogICAg
fSwKICAgIHsKICAgICAidXNlIjogInVzdWFsIiwKICAgICAidHlwZSI6IHsKICAgICAgICJjb2Rp
bmciOiBbCiAgICAgICAgIHsKICAgICAgICAgICAic3lzdGVtIjogImh0dHA6Ly9obDcub3JnL2Zo
aXIvc2lkL3VzLXNzbiIsCiAgICAgICAgICAgImNvZGUiOiAiU1MiCiAgICAgICAgIH0KICAgICAg
IF0KICAgICB9LAogICAgICJ2YWx1ZSI6IDEyMzQ1Njc4OQogICB9CiAgXSwKICAiYWRkcmVzcyI6
IFsKICAgIHsKICAgICAgInVzZSI6ICJob21lIiwKICAgICAgImxpbmUiOiBbCiAgICAgICAgIjE5
NzkgTWlsa3kgV2F5IERyLiIKICAgICAgXSwKICAgICAgImNpdHkiOiAiVmVyb25hIiwKICAgICAg
InN0YXRlIjogIldJIiwKICAgICAgInBvc3RhbENvZGUiOiAiNTM1OTMiLAogICAgICAiY291bnRy
eSI6ICJVUyIKICAgIH0sCiAgICB7CiAgICAgICJ1c2UiOiAidGVtcCIsCiAgICAgICJsaW5lIjog
WwogICAgICAgICI1MzAxIFRva2F5IEJsdmQiCiAgICAgIF0sCiAgICAgICJjaXR5IjogIk1BRElT
T04iLAogICAgICAic3RhdGUiOiAiV0kiLAogICAgICAicG9zdGFsQ29kZSI6ICI1MzcxMSIsCiAg
ICAgICJjb3VudHJ5IjogIlVTIiwKICAgICAgInBlcmlvZCI6IHsKICAgICAgICAic3RhcnQiOiAi
MjAxMS0wOC0wNFQwMDowMDowMFoiLAogICAgICAgICJlbmQiOiAiMjAxNC0wOC0wNFQwMDowMDow
MFoiCiAgICAgIH0KICAgIH0KICBdLAogICJ0ZWxlY29tIjogWwogICAgewogICAgICAic3lzdGVt
IjogInBob25lIiwKICAgICAgInZhbHVlIjogIjYwOC0yNzEtOTAwMCIsCiAgICAgICJ1c2UiOiAi
aG9tZSIKICAgIH0sCiAgICB7CiAgICAgICJzeXN0ZW0iOiAicGhvbmUiLAogICAgICAidmFsdWUi
OiAiNjA4LTc3MS05MDAwIiwKICAgICAgInVzZSI6ICJ3b3JrIgogICAgfSwKICAgIHsKICAgICAg
InN5c3RlbSI6ICJwaG9uZSIsCiAgICAgICJ2YWx1ZSI6ICI2MDgtNzcxLTkwMDAiLAogICAgICAi
dXNlIjogIm1vYmlsZSIKICAgIH0sCiAgICB7CiAgICAgICJzeXN0ZW0iOiAiZmF4IiwKICAgICAg
InZhbHVlIjogIjYwOC03NzEtOTAwMCIsCiAgICAgICJ1c2UiOiAiaG9tZSIKICAgIH0sCiAgICB7
CiAgICAgICJzeXN0ZW0iOiAicGhvbmUiLAogICAgICAidmFsdWUiOiAiNjA4LTc3MS05MDAwIiwK
ICAgICAgInVzZSI6ICJ0ZW1wIiwKICAgICAgInBlcmlvZCI6IHsKICAgICAgICAic3RhcnQiOiAi
MjAxMS0wOC0wNFQwMDowMDowMFoiLAogICAgICAgICJlbmQiOiAiMjAxNC0wOC0wNFQwMDowMDow
MFoiCiAgICAgIH0KICAgIH0sCiAgICB7CiAgICAgICJzeXN0ZW0iOiAiZW1haWwiLAogICAgICAi
dmFsdWUiOiAib3BlbkBlcGljLmNvbSIKICAgIH0KICBdLAogICJtYXJpdGFsU3RhdHVzIjogewog
ICAgInRleHQiOiAiU2luZ2xlIiwKICAgICJjb2RpbmciOiBbCiAgICAgIHsKICAgICAgICAic3lz
dGVtIjogImh0dHA6Ly9obDcub3JnL2ZoaXIvVmFsdWVTZXQvbWFyaXRhbC1zdGF0dXMiLAogICAg
ICAgICJjb2RlIjogIlMiLAogICAgICAgICJkaXNwbGF5IjogIk5ldmVyIE1hcnJpZWQiCiAgICAg
IH0KICAgIF0KICB9LAogICJjb21tdW5pY2F0aW9uIjogWwogICAgewogICAgICAicHJlZmVycmVk
IjogdHJ1ZSwKICAgICAgImxhbmd1YWdlIjogewogICAgICAgICJ0ZXh0IjogIkVuZ2xpc2giLAog
ICAgICAgICJjb2RpbmciOiBbCiAgICAgICAgICB7CiAgICAgICAgICAgICJzeXN0ZW0iOiAidXJu
Om9pZDoyLjE2Ljg0MC4xLjExMzg4My42Ljk5IiwKICAgICAgICAgICAgImNvZGUiOiAiZW4iLAog
ICAgICAgICAgICAiZGlzcGxheSI6ICJFbmdsaXNoIgogICAgICAgICAgfQogICAgICAgIF0KICAg
ICAgfQogICAgfQogIF0sCiAgImV4dGVuc2lvbiI6IFsKICAgIHsKICAgICAgInVybCI6ICJodHRw
Oi8vaGw3Lm9yZy9maGlyL1N0cnVjdHVyZURlZmluaXRpb24vdXMtY29yZS1yYWNlIiwKICAgICAg
InZhbHVlQ29kZWFibGVDb25jZXB0IjogewogICAgICAgICJ0ZXh0IjogIkFzaWFuIiwKICAgICAg
ICAiY29kaW5nIjogWwogICAgICAgICAgewogICAgICAgICAgICAic3lzdGVtIjogIjIuMTYuODQw
LjEuMTEzODgzLjUuMTA0IiwKICAgICAgICAgICAgImNvZGUiOiAiMjAyOC05IiwKICAgICAgICAg
ICAgImRpc3BsYXkiOiAiQXNpYW4iCiAgICAgICAgICB9CiAgICAgICAgXQogICAgICB9CiAgICB9
LAogICAgewogICAgICAidXJsIjogImh0dHA6Ly9obDcub3JnL2ZoaXIvU3RydWN0dXJlRGVmaW5p
dGlvbi91cy1jb3JlLWV0aG5pY2l0eSIsCiAgICAgICJ2YWx1ZUNvZGVhYmxlQ29uY2VwdCI6IHsK
ICAgICAgICAidGV4dCI6ICJOb3QgSGlzcGFuaWMgb3IgTGF0aW5vIiwKICAgICAgICAiY29kaW5n
IjogWwogICAgICAgICAgewogICAgICAgICAgICAic3lzdGVtIjogIjIuMTYuODQwLjEuMTEzODgz
LjUuNTAiLAogICAgICAgICAgICAiY29kZSI6ICIyMTg2LTUiLAogICAgICAgICAgICAiZGlzcGxh
eSI6ICJOb3QgSGlzcGFuaWMgb3IgTGF0aW5vIgogICAgICAgICAgfQogICAgICAgIF0KICAgICAg
fQogICAgfSwKICAgIHsKICAgICAgInVybCI6ICJodHRwOi8vaGw3Lm9yZy9maGlyL1N0cnVjdHVy
ZURlZmluaXRpb24vdXMtY29yZS1iaXJ0aC1zZXgiLAogICAgICAidmFsdWVDb2RlYWJsZUNvbmNl
cHQiOiB7CiAgICAgICAgInRleHQiOiAiTWFsZSIsCiAgICAgICAgImNvZGluZyI6IFsKICAgICAg
ICAgIHsKICAgICAgICAgICAgInN5c3RlbSI6ICJodHRwOi8vaGw3Lm9yZy9maGlyL3YzL0FkbWlu
aXN0cmF0aXZlR2VuZGVyIiwKICAgICAgICAgICAgImNvZGUiOiAiTSIsCiAgICAgICAgICAgICJk
aXNwbGF5IjogIk1hbGUiCiAgICAgICAgICB9CiAgICAgICAgXQogICAgICB9CiAgICB9CiAgXQp9
CgoK</inboundTemplate>
        <outboundTemplate encoding="base64"></outboundTemplate>
        <inboundDataType>JSON</inboundDataType>
        <outboundDataType>JSON</outboundDataType>
        <inboundProperties class="com.mirth.connect.plugins.datatypes.json.JSONDataTypeProperties" version="3.5.0">
          <batchProperties class="com.mirth.connect.plugins.datatypes.json.JSONBatchProperties" version="3.5.0">
            <splitType>JavaScript</splitType>
            <batchScript></batchScript>
          </batchProperties>
        </inboundProperties>
        <outboundProperties class="com.mirth.connect.plugins.datatypes.json.JSONDataTypeProperties" version="3.5.0">
          <batchProperties class="com.mirth.connect.plugins.datatypes.json.JSONBatchProperties" version="3.5.0">
            <splitType>JavaScript</splitType>
            <batchScript></batchScript>
          </batchProperties>
        </outboundProperties>
      </transformer>
      <responseTransformer version="3.5.0">
        <elements/>
        <inboundDataType>JSON</inboundDataType>
        <outboundDataType>JSON</outboundDataType>
        <inboundProperties class="com.mirth.connect.plugins.datatypes.json.JSONDataTypeProperties" version="3.5.0">
          <batchProperties class="com.mirth.connect.plugins.datatypes.json.JSONBatchProperties" version="3.5.0">
            <splitType>JavaScript</splitType>
            <batchScript></batchScript>
          </batchProperties>
        </inboundProperties>
        <outboundProperties class="com.mirth.connect.plugins.datatypes.json.JSONDataTypeProperties" version="3.5.0">
          <batchProperties class="com.mirth.connect.plugins.datatypes.json.JSONBatchProperties" version="3.5.0">
            <splitType>JavaScript</splitType>
            <batchScript></batchScript>
          </batchProperties>
        </outboundProperties>
      </responseTransformer>
      <filter version="3.5.0">
        <elements>
          <com.mirth.connect.plugins.javascriptrule.JavaScriptRule>
            <name>Check Birthday</name>
            <sequenceNumber>0</sequenceNumber>
            <script>if (msg[&apos;birthDate&apos;]!= null)
	return true;
else
	return false;</script>
          </com.mirth.connect.plugins.javascriptrule.JavaScriptRule>
          <com.mirth.connect.plugins.javascriptrule.JavaScriptRule>
            <name>Check Last name</name>
            <sequenceNumber>1</sequenceNumber>
            <operator>AND</operator>
            <script>if (msg[&apos;name&apos;][0][&apos;family&apos;][0] != null)
	return true;
else
	return false;</script>
          </com.mirth.connect.plugins.javascriptrule.JavaScriptRule>
          <com.mirth.connect.plugins.javascriptrule.JavaScriptRule>
            <name>Check first name</name>
            <sequenceNumber>2</sequenceNumber>
            <operator>AND</operator>
            <script>if(msg[&apos;name&apos;][0][&apos;given&apos;][0] != null)
	return true;
else
	return false;</script>
          </com.mirth.connect.plugins.javascriptrule.JavaScriptRule>
        </elements>
      </filter>
      <transportName>Database Writer</transportName>
      <mode>DESTINATION</mode>
      <enabled>true</enabled>
      <waitForPrevious>true</waitForPrevious>
    </connector>
  </destinationConnectors>
  <preprocessingScript>// Modify the message variable below to pre process data
return message;</preprocessingScript>
  <postprocessingScript>// This script executes once after a message has been processed
// Responses returned from here will be stored as &quot;Postprocessor&quot; in the response map
return;</postprocessingScript>
  <deployScript>// This script executes once when the channel is deployed
// You only have access to the globalMap and globalChannelMap here to persist data
return;</deployScript>
  <undeployScript>// This script executes once when the channel is undeployed
// You only have access to the globalMap and globalChannelMap here to persist data
return;</undeployScript>
  <properties version="3.5.0">
    <clearGlobalChannelMap>true</clearGlobalChannelMap>
    <messageStorageMode>DEVELOPMENT</messageStorageMode>
    <encryptData>false</encryptData>
    <removeContentOnCompletion>false</removeContentOnCompletion>
    <removeOnlyFilteredOnCompletion>false</removeOnlyFilteredOnCompletion>
    <removeAttachmentsOnCompletion>false</removeAttachmentsOnCompletion>
    <initialState>STARTED</initialState>
    <storeAttachments>false</storeAttachments>
    <metaDataColumns>
      <metaDataColumn>
        <name>SOURCE</name>
        <type>STRING</type>
        <mappingName>mirth_source</mappingName>
      </metaDataColumn>
      <metaDataColumn>
        <name>TYPE</name>
        <type>STRING</type>
        <mappingName>mirth_type</mappingName>
      </metaDataColumn>
    </metaDataColumns>
    <attachmentProperties version="3.5.0">
      <type>None</type>
      <properties/>
    </attachmentProperties>
    <resourceIds class="linked-hash-map">
      <entry>
        <string>Default Resource</string>
        <string>[Default Resource]</string>
      </entry>
    </resourceIds>
  </properties>
  <exportData>
    <metadata>
      <enabled>true</enabled>
      <lastModified>
        <time>1505462020917</time>
        <timezone>Asia/Kolkata</timezone>
      </lastModified>
      <pruningSettings>
        <archiveEnabled>true</archiveEnabled>
      </pruningSettings>
    </metadata>
  </exportData>
</channel>